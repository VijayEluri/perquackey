#!/usr/bin/env ruby
require 'optparse'
require 'ostruct'

conf = OpenStruct.new(:mode => :console, :port => 3000)

opts = OptionParser.new do |opts|
  opts.banner = "Usage: #{File.basename($0)} [options]"
  opts.separator ''
  opts.on('-s', '--server', 'Run as a web server') { conf.mode = :server }
  opts.on('-p', '--port PORT', "Port for web server (defaults to #{conf.port})") { |port| conf.port = port }
  opts.on('-h', '--help', 'Show this message') { puts opts; exit }
  opts.separator ''
end

opts.parse! ARGV

case conf.mode
when :console
  require 'perquackey/console'
when :server
  require 'perquackey/server'
  Perquackey::Server.run!(:port => conf.port)
end
