#!/usr/bin/env ruby
#
# To run this script in-project (rather than via rubygems wrapper), you'll
# need to say something like:
#
#   RUBYOPT=rubygems RUBYLIB=ext:lib ./bin/perquackey
#
require 'optparse'
require 'ostruct'
require 'perquackey'

conf = OpenStruct.new(:mode => :console, :port => 3000)

opts = OptionParser.new do |opts|
  opts.banner = "Usage: #{File.basename($0)} [options]"
  opts.separator ''
  opts.on('-s', '--server', 'Run as a web server') { conf.mode = :server }
  opts.on('-p', '--port PORT', "Port for web server (defaults to #{conf.port})") { |port| conf.port = port }
  opts.on('-h', '--help', 'Show this message') { puts opts; exit }
  opts.separator ''
end

opts.parse! ARGV

case conf.mode
when :console
  Perquackey::Console.run!
when :server
  Perquackey::Server.run!(:port => conf.port)
end
